<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>class02</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="class02_files/libs/clipboard/clipboard.min.js"></script>
<script src="class02_files/libs/quarto-html/quarto.js"></script>
<script src="class02_files/libs/quarto-html/popper.min.js"></script>
<script src="class02_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="class02_files/libs/quarto-html/anchor.min.js"></script>
<link href="class02_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="class02_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="class02_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="class02_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="class02_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">




<section id="capítulo-2" class="level1 unnumbered">
<h1 class="unnumbered">Capítulo 2</h1>
<p>No capítulo anterior, vimos sobre a história e o funcionamento do R e RStudio, introduzindo o fluxo de trabalho e as operações fundamentais. Vimos três tipos de valores que podemos utilizar na programação: números, caracteres/texto e lógica (TRUE/FALSE). Depois, como armazenar e manusear os valores em objetos na memória, em duas estrutura de dados: vetores e data.frame. Vimos como são estruturadas e como usar as funções e, por fim, manuseamos dados usando testes lógicos. Todas as operações foram feitas com a base do R, usando comandos e funções elementares.</p>
<p>Até aqui, espero que você saiba os comandos básicos para inserir comentários e atribuir valores a objetos, manusear objetos que guardam vetores e data.frames, usar funções e fazer testes lógicos.</p>
<p>Neste capítulo, continuaremos a explorar as operações e funções fundamentais de uma forma mais aprofundada.</p>
<section id="funções-uma-ideia-mais-detalhada" class="level2">
<h2 class="anchored" data-anchor-id="funções-uma-ideia-mais-detalhada">Funções: uma ideia mais detalhada</h2>
<p>Vimos que funções são operações programadas, que são executadas recebendo (ou não) argumentos de <em>input</em> e retornando algum resultado do processamento (<em>output</em>). As funções são estruturadas por um nome, seguido de parênteses dentro dos quais entram os argumentos de <em>input.</em></p>
<p>Há um conjunto de funções básicas que já vem com o R e podem ser utilizadas, como a função “ifelse”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># teste = 1 é maior do que 3? </span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Se sim, retorne "Verdade", se não, "Mentira" </span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ifelse</span>( <span class="at">test =</span> <span class="dv">1</span><span class="sc">&gt;</span><span class="dv">3</span>, </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"Verdade"</span>, </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span><span class="st">"Mentira"</span> ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Mentira"</code></pre>
</div>
</div>
<p>Usando a sintaxe do R, podemos também programar uma função. Para isso, usamos a seguinte estrutura de comandos:</p>
<p>nome_da_funcao &lt;- <strong>function</strong>( input ) { algum processamento do input }</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Criando uma função</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>x_mais_1 <span class="ot">&lt;-</span> <span class="cf">function</span>( x ) { x <span class="sc">+</span> <span class="dv">1</span> }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Observe que a função criada aparece na memória como um objeto do tipo “function”, na janela de ambiente global. Agora, podemos utilizar a função criada.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Utilizando a função criada</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">x_mais_1</span>(<span class="at">x =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3</code></pre>
</div>
</div>
<p>Este é um exemplo didático. Em geral, as funções executam operações complexas e servem para facilitar o nosso código. Veja o exemplo abaixo:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>frase_exemplo <span class="ot">&lt;-</span> <span class="cf">function</span>( x, y ) { </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(<span class="st">"Meu nome é"</span>,x,<span class="st">"e tenho"</span>,y,<span class="st">"anos"</span>)  }</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># a função "paste" cola textos com valores guardados em objetos</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="fu">frase_exemplo</span>(<span class="at">x =</span> <span class="st">"Victor"</span>,<span class="at">y =</span> <span class="dv">26</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Meu nome é Victor e tenho 26 anos"</code></pre>
</div>
</div>
<p>Além das funções básicas do R, temos muitas outras que foram programadas pela comunidade de usuários, entre as quais aquelas desenvolvidas por Hadley Wickham para análise de dados com R. As funções programadas são agrupadas em pacotes, que são disponibilizados pelo CRAN ou em plataformas de desenvolvedores, como o GitHub. Os pacotes no CRAN passam por inspeção do grupo de controle e podem ser instalados diretos pelo R. Já os pacotes em outras plataformas podem ser instalados usando funções específicas.</p>
<p>Para usar os pacotes, temos primeiro que instalar em nosso computador local, usando a função install.packages( ).</p>
<ul>
<li>install.packages( ) : função para instalar pacotes distribuídos pelo CRAN</li>
</ul>
<p>Precisamos fazer a instalação apenas uma vez. Quando feita, teremos o pacote salvo em nosso computador, em uma pasta dentro dos arquivos do R. Sempre que precisarmos do pacote em um código, porém, devemos carregá-lo na memória, usando a função library( ).</p>
<ul>
<li>library( ) : função para carregar na memóroia os pacotes instalados no computador</li>
</ul>
<p>Agora, podemos instalar e carregar na memória o pacote mais famoso do R: o tidyverse. Logo começaremos a usá-lo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("tidyverse")</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.1     ✔ tibble    3.2.1
✔ lubridate 1.9.3     ✔ tidyr     1.3.1
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
</div>
<p>A instalação e carregameto de pacotes sempre deve ser feita no início do <em>script</em>, compondo a parte de setup. Como os comandos são executados conforme a ordem em que aparecem no <em>script</em>, devemos começar com o setup do nosso ambiente de trabalho. Embora seja possível executar muitas operações com os botões disponibilizados pelo RStudio, é mais eficiente executá-las com comandos. No próximo tópico, veremos operações de rotina para a organização do ambiente de trabalho.</p>
</section>
</section>
<section id="setup" class="level1">
<h1>Setup</h1>
<p>Há três configurações de setup que devemos incorporar no nosso <em>script</em>:</p>
<ol type="1">
<li><p>gestão da memória;</p></li>
<li><p>gestão das funções e pacotes;</p></li>
<li><p>gestão do diretório.</p></li>
</ol>
<section id="gestão-da-memória" class="level4">
<h4 class="anchored" data-anchor-id="gestão-da-memória">Gestão da memória</h4>
<p>Temos um conjunto de funções muito úteis para limpar a memória local (o que ajuda no processamento) e obter o diretório (pasta) principal onde estamos trabalhando.</p>
<ul>
<li><p>rm( ) : de “Remove”, para remover objetos da memória</p></li>
<li><p>ls( ) : de “List”, para listar objetos guardados na memória</p></li>
<li><p>gc( ) : de “Garbage Clean”, para limpeza da lixeira e liberação de memória.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Título do script: Como iniciar um script</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Autor: Victor G Alcantara</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Setup -------------------------------------------------------</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Gestão da memória</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span>() <span class="co"># Para listar objetos salvos na memória</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "frase_exemplo" "x_mais_1"     </code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>( <span class="at">list=</span><span class="fu">ls</span>() ) <span class="co"># Remove todos os objetos listados na memória</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">gc</span>() <span class="co"># Faz a limpeza da lixeira da memória</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          used (Mb) gc trigger  (Mb) max used (Mb)
Ncells  964661 51.6    1904495 101.8  1360134 72.7
Vcells 1663699 12.7    8388608  64.0  2282309 17.5</code></pre>
</div>
</div>
</section>
<section id="gestão-de-funçõespacotes" class="level4">
<h4 class="anchored" data-anchor-id="gestão-de-funçõespacotes">Gestão de funções/pacotes</h4>
<p>Após a limpeza da memória, devemos inserir comandos para instalar (se necessário) e carregar na memória os pacotes de funções externas que serão utilizados. Para isso, utilizamos:</p>
<ul>
<li><p>install.packages( ) : para instalar pacotes</p></li>
<li><p>library( ) : para carregar pacotes na memória</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Título do script: Como iniciar um script</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Autor: Victor G Alcantara</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Setup -------------------------------------------------------</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Gestão da memória</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>( <span class="at">list =</span> <span class="fu">ls</span>() ) <span class="co"># Remove todos os objetos listados na memória</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="fu">gc</span>() <span class="co"># Faz a limpeza da lixeira da memória</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          used (Mb) gc trigger  (Mb) max used (Mb)
Ncells  964658 51.6    1904495 101.8  1360134 72.7
Vcells 1663872 12.7    8388608  64.0  2282309 17.5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Gestão de funções e pacotes</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"tidyverse"</span>) <span class="co"># Instala o pacote tidyverse como exemplo</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: o pacote 'tidyverse' está em uso e não será instalado</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="co"># Carrega o pacote tidyverse como exemplo</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="gestão-de-diretórios" class="level4">
<h4 class="anchored" data-anchor-id="gestão-de-diretórios">Gestão de diretórios</h4>
<p>Após gerir a memória e as funções, definimos nosso diretório de trabalho. Essa etapa é muito importante, porque o R trabalha tendo como referência o diretório principal definido para acessar arquivos e navegar pelo computador. Para isso, utilizamos as funções:</p>
<ul>
<li><p>getwd( ) : de “Get Working Directory”, para obter diretório principal no qual está trabalhando</p></li>
<li><p>setwd( ) : de “Get Working Directory”, para definir o diretório principal</p>
<p>Aqui temos o primeiro detalhe do R. Como foi projetado para operar em Linux, ele reconhece o endereço do diretório com as barras ao contrário de como é usado no Windows e Mac. Assim, devemos inverter a posição das barras quando copiamos o caminho de um diretório onde vamos trabalhar.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Título do script: Como iniciar um script</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Autor: Victor G Alcantara</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Setup -------------------------------------------------------</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Gestão da memória</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>( <span class="at">list =</span> <span class="fu">ls</span>() ) <span class="co"># Remove todos os objetos listados na memória</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="fu">gc</span>() <span class="co"># Faz a limpeza da lixeira da memória</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          used (Mb) gc trigger  (Mb) max used (Mb)
Ncells  973840 52.1    1904495 101.8  1360134 72.7
Vcells 1686540 12.9    8388608  64.0  2282309 17.5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Gestão de funções e pacotes</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"tidyverse"</span>) <span class="co"># Instala o pacote tidyverse como exemplo</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: o pacote 'tidyverse' está em uso e não será instalado</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="co"># Carrega o pacote tidyverse como exemplo</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Gestão do diretório</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="fu">getwd</span>() <span class="co"># Verifica diretório principal de trabalho</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "C:/Users/13477365/Documents/book-dadoscomr"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="at">dir =</span> <span class="st">"C:/Users/13477365/Documents/book-dadoscomr"</span>) <span class="co"># Define diretório principal de trabalho</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Atenção à posição das barras! Deve estar como "/"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Agora, com o ambiente pronto para o trabalho, podemos iniciar a importação e dar continuidade ao fluxo.</p>
<p>Antes de entrarmos no fluxo de análise de dados, vamos retomar as operações fundamentais para entender como funcionam comandos relacionais e condicionais.</p>
</section>
<section id="comandos-relacionais" class="level3">
<h3 class="anchored" data-anchor-id="comandos-relacionais">Comandos relacionais</h3>
<p>As operações relacionais são usadas para combinar ou inverter testes e condições. Temos três operadores relacionais principais:</p>
<p>AND ( <strong>&amp;</strong> ): Retorna TRUE se ambas as condições forem verdadeiras.</p>
<p>OR ( <strong>|</strong> ): Retorna TRUE se pelo menos uma condição for verdadeira.</p>
<p>NOT ( <strong>!</strong> ): Inverte o valor lógico, transformando TRUE em FALSE e vice-versa.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># "&amp;" para "E"</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="sc">&gt;</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="dv">2</span> <span class="sc">==</span> <span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Leitura: 2 é maior que 2 E é igual a 2?</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co"># R: Não (FALSE), pois 2 não é maior que 2</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="sc">&gt;</span> <span class="dv">1</span> <span class="sc">&amp;</span> <span class="dv">2</span> <span class="sc">==</span> <span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Leitura: 2 é maior que 1 E é igual a 2?</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co"># R: Sim (TRUE), 2 é maior que 1 E é igual a 2</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co"># "|" para "OU"</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="sc">&gt;</span> <span class="dv">2</span> <span class="sc">|</span> <span class="dv">2</span> <span class="sc">==</span> <span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Leitura: 2 é maior que 1 OU é igual a 2?</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="co"># R: Sim (TRUE), pois 2 é igual a 2</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="sc">&gt;</span> <span class="dv">2</span> <span class="sc">|</span> <span class="dv">2</span> <span class="sc">&lt;</span> <span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Leitura: 2 é maior que 2 OU é menor que 2?</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="co"># R: Não (FALSE), 2 não é maior que 2 OU menor que 2</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="sc">!</span><span class="dv">2</span> <span class="sc">&gt;</span> <span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Leitura: inverta o resultado do teste 2 é maior que 2</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="co"># R: Sim (TRUE), 2 é maior que 2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Para que isso? Imagine que você queira construir categorias cruzadas de sexo e raça. Para identificar mulheres E negras, seu comando será:</p>
<p>dados$sexo == “Feminino” &amp; dados$raca == “Negra”</p>
<p>Vamos colocar esses comandos em prática com dados reais.</p>
</section>
</section>
<section id="import" class="level1">
<h1>Import</h1>
<p>Como você já deve ter percebido, é possível construir comandos complexos com as operações básicas. Contudo, a partir de agora, vamos começar a usar os pacotes para facilitar a nossa vida.</p>
<p>Os primeiros pacotes que vamos utilizar é o <em>Rio (R Input Output)</em> e o <em>Tidyverse</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Título do script: Como iniciar um script</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Autor: Victor G Alcantara</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Setup -------------------------------------------------------</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Gestão da memória</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>( <span class="at">list =</span> <span class="fu">ls</span>() ) <span class="co"># Remove todos os objetos listados na memória</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="fu">gc</span>() <span class="co"># Faz a limpeza da lixeira da memória</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          used (Mb) gc trigger  (Mb) max used (Mb)
Ncells  973884 52.1    1904495 101.8  1360134 72.7
Vcells 1686912 12.9    8388608  64.0  2282309 17.5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Gestão de funções e pacotes</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("tidyverse") # Instala o pacote tidyverse como exemplo</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("rio") # R Input Output,  para impotar e exportar dados</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rio)</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Gestão do diretório</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="fu">getwd</span>() <span class="co"># Verifica diretório principal de trabalho</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "C:/Users/13477365/Documents/book-dadoscomr"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="at">dir =</span> <span class="st">"C:/Users/13477365/Documents/book-dadoscomr"</span>) <span class="co"># Define diretório principal de trabalho</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Atenção à posição das barras! Deve estar como "/"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Agora, vamos importar nosso primeiro dado de trabalho.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import ---------------------------------------------------</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>saeb21 <span class="ot">&lt;-</span> <span class="fu">import</span>( <span class="st">"D:/01 - data/EDUC/SAEB/2021/DADOS/TS_ESCOLA.csv"</span>, </span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">encoding =</span> <span class="st">"Latin-1"</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Observe que defini o encoding do arquivo como “Latin-1”, para identificar os acentos usados em línguas latinas como o português.</p>
<p>Com os dados importados para a memória, podemos explorar as funções fundamentais no tratamento de dados.</p>
<p>Em primeiro lugar, temos um conjunto de funções muito úteis para olhar para a estrutura dos dados. Diferente do SPSS e Excel, quando importamos um conjunto de dados e guardamos em um objeto, eles ficam armazenados na memória de modo que não observamos diretamente. É possível abrir a planilha de dados, mas não é recomendado quando os dados possuem larga escala, pois consome muito do processamento do computador. Por isso, utilizamos funções para verificar a estrutura dos nossos dados.</p>
<ul>
<li><p>dim( ): retorna as dimensões da base de dados (linhas x colunas)</p></li>
<li><p>head( ): retorna os primeiros valores da base de dados (default = 5, mas passível de alteração)</p></li>
<li><p>tail( ): retorna os últimos valores da base de dados (default = 5, mas passível de alteração)</p></li>
<li><p>names( ): retorna o nome das colunas/variáveis</p></li>
<li><p>str( ): retorna a estrutura da base de dados, indicando as dimensões e o tipo de cada variável</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(saeb21)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 70897   137</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># O Saeb 2021 tem 70.897 linhas e 137 colunas</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(saeb21)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] "ID_SAEB"                     "ID_REGIAO"                  
  [3] "ID_UF"                       "ID_MUNICIPIO"               
  [5] "ID_AREA"                     "ID_ESCOLA"                  
  [7] "IN_PUBLICA"                  "ID_LOCALIZACAO"             
  [9] "PC_FORMACAO_DOCENTE_INICIAL" "PC_FORMACAO_DOCENTE_FINAL"  
 [11] "PC_FORMACAO_DOCENTE_MEDIO"   "NIVEL_SOCIO_ECONOMICO"      
 [13] "NU_MATRICULADOS_CENSO_5EF"   "NU_PRESENTES_5EF"           
 [15] "TAXA_PARTICIPACAO_5EF"       "NIVEL_0_LP5"                
 [17] "NIVEL_1_LP5"                 "NIVEL_2_LP5"                
 [19] "NIVEL_3_LP5"                 "NIVEL_4_LP5"                
 [21] "NIVEL_5_LP5"                 "NIVEL_6_LP5"                
 [23] "NIVEL_7_LP5"                 "NIVEL_8_LP5"                
 [25] "NIVEL_9_LP5"                 "NIVEL_0_MT5"                
 [27] "NIVEL_1_MT5"                 "NIVEL_2_MT5"                
 [29] "NIVEL_3_MT5"                 "NIVEL_4_MT5"                
 [31] "NIVEL_5_MT5"                 "NIVEL_6_MT5"                
 [33] "NIVEL_7_MT5"                 "NIVEL_8_MT5"                
 [35] "NIVEL_9_MT5"                 "NIVEL_10_MT5"               
 [37] "NU_MATRICULADOS_CENSO_9EF"   "NU_PRESENTES_9EF"           
 [39] "TAXA_PARTICIPACAO_9EF"       "NIVEL_0_LP9"                
 [41] "NIVEL_1_LP9"                 "NIVEL_2_LP9"                
 [43] "NIVEL_3_LP9"                 "NIVEL_4_LP9"                
 [45] "NIVEL_5_LP9"                 "NIVEL_6_LP9"                
 [47] "NIVEL_7_LP9"                 "NIVEL_8_LP9"                
 [49] "NIVEL_0_MT9"                 "NIVEL_1_MT9"                
 [51] "NIVEL_2_MT9"                 "NIVEL_3_MT9"                
 [53] "NIVEL_4_MT9"                 "NIVEL_5_MT9"                
 [55] "NIVEL_6_MT9"                 "NIVEL_7_MT9"                
 [57] "NIVEL_8_MT9"                 "NIVEL_9_MT9"                
 [59] "NU_MATRICULADOS_CENSO_EMT"   "NU_PRESENTES_EMT"           
 [61] "TAXA_PARTICIPACAO_EMT"       "NIVEL_0_LPEMT"              
 [63] "NIVEL_1_LPEMT"               "NIVEL_2_LPEMT"              
 [65] "NIVEL_3_LPEMT"               "NIVEL_4_LPEMT"              
 [67] "NIVEL_5_LPEMT"               "NIVEL_6_LPEMT"              
 [69] "NIVEL_7_LPEMT"               "NIVEL_8_LPEMT"              
 [71] "NIVEL_0_MTEMT"               "NIVEL_1_MTEMT"              
 [73] "NIVEL_2_MTEMT"               "NIVEL_3_MTEMT"              
 [75] "NIVEL_4_MTEMT"               "NIVEL_5_MTEMT"              
 [77] "NIVEL_6_MTEMT"               "NIVEL_7_MTEMT"              
 [79] "NIVEL_8_MTEMT"               "NIVEL_9_MTEMT"              
 [81] "NIVEL_10_MTEMT"              "NU_MATRICULADOS_CENSO_EMI"  
 [83] "NU_PRESENTES_EMI"            "TAXA_PARTICIPACAO_EMI"      
 [85] "NIVEL_0_LPEMI"               "NIVEL_1_LPEMI"              
 [87] "NIVEL_2_LPEMI"               "NIVEL_3_LPEMI"              
 [89] "NIVEL_4_LPEMI"               "NIVEL_5_LPEMI"              
 [91] "NIVEL_6_LPEMI"               "NIVEL_7_LPEMI"              
 [93] "NIVEL_8_LPEMI"               "NIVEL_0_MTEMI"              
 [95] "NIVEL_1_MTEMI"               "NIVEL_2_MTEMI"              
 [97] "NIVEL_3_MTEMI"               "NIVEL_4_MTEMI"              
 [99] "NIVEL_5_MTEMI"               "NIVEL_6_MTEMI"              
[101] "NIVEL_7_MTEMI"               "NIVEL_8_MTEMI"              
[103] "NIVEL_9_MTEMI"               "NIVEL_10_MTEMI"             
[105] "NU_MATRICULADOS_CENSO_EM"    "NU_PRESENTES_EM"            
[107] "TAXA_PARTICIPACAO_EM"        "NIVEL_0_LPEM"               
[109] "NIVEL_1_LPEM"                "NIVEL_2_LPEM"               
[111] "NIVEL_3_LPEM"                "NIVEL_4_LPEM"               
[113] "NIVEL_5_LPEM"                "NIVEL_6_LPEM"               
[115] "NIVEL_7_LPEM"                "NIVEL_8_LPEM"               
[117] "NIVEL_0_MTEM"                "NIVEL_1_MTEM"               
[119] "NIVEL_2_MTEM"                "NIVEL_3_MTEM"               
[121] "NIVEL_4_MTEM"                "NIVEL_5_MTEM"               
[123] "NIVEL_6_MTEM"                "NIVEL_7_MTEM"               
[125] "NIVEL_8_MTEM"                "NIVEL_9_MTEM"               
[127] "NIVEL_10_MTEM"               "MEDIA_5EF_LP"               
[129] "MEDIA_5EF_MT"                "MEDIA_9EF_LP"               
[131] "MEDIA_9EF_MT"                "MEDIA_EMT_LP"               
[133] "MEDIA_EMT_MT"                "MEDIA_EMI_LP"               
[135] "MEDIA_EMI_MT"                "MEDIA_EM_LP"                
[137] "MEDIA_EM_MT"                </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(saeb21,<span class="at">n =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  ID_SAEB ID_REGIAO ID_UF ID_MUNICIPIO ID_AREA ID_ESCOLA IN_PUBLICA
1    2021         1    11      6316600       2  61324549          1
2    2021         1    11      6316600       2  61335087          1
3    2021         1    11      6316600       2  61336597          1
  ID_LOCALIZACAO PC_FORMACAO_DOCENTE_INICIAL PC_FORMACAO_DOCENTE_FINAL
1              1                       100.0                      51.1
2              1                        92.5                      63.9
3              2                       100.0                      56.8
  PC_FORMACAO_DOCENTE_MEDIO NIVEL_SOCIO_ECONOMICO NU_MATRICULADOS_CENSO_5EF
1                        NA              Nível IV                        18
2                        NA              Nível IV                        23
3                        NA              Nível IV                        19
  NU_PRESENTES_5EF TAXA_PARTICIPACAO_5EF NIVEL_0_LP5 NIVEL_1_LP5 NIVEL_2_LP5
1               17             0.9444444          25       18.75          25
2               14             0.6086957          NA          NA          NA
3               15             0.7894737          NA          NA          NA
  NIVEL_3_LP5 NIVEL_4_LP5 NIVEL_5_LP5 NIVEL_6_LP5 NIVEL_7_LP5 NIVEL_8_LP5
1        12.5        12.5        6.25           0           0           0
2          NA          NA          NA          NA          NA          NA
3          NA          NA          NA          NA          NA          NA
  NIVEL_9_LP5 NIVEL_0_MT5 NIVEL_1_MT5 NIVEL_2_MT5 NIVEL_3_MT5 NIVEL_4_MT5
1           0        6.25       31.25          25        12.5       18.75
2          NA          NA          NA          NA          NA          NA
3          NA          NA          NA          NA          NA          NA
  NIVEL_5_MT5 NIVEL_6_MT5 NIVEL_7_MT5 NIVEL_8_MT5 NIVEL_9_MT5 NIVEL_10_MT5
1        6.25           0           0           0           0            0
2          NA          NA          NA          NA          NA           NA
3          NA          NA          NA          NA          NA           NA
  NU_MATRICULADOS_CENSO_9EF NU_PRESENTES_9EF TAXA_PARTICIPACAO_9EF NIVEL_0_LP9
1                        19               15             0.7894737          NA
2                        24               21             0.8750000        9.52
3                        18               13             0.7222222          NA
  NIVEL_1_LP9 NIVEL_2_LP9 NIVEL_3_LP9 NIVEL_4_LP9 NIVEL_5_LP9 NIVEL_6_LP9
1          NA          NA          NA          NA          NA          NA
2        9.52       19.05        38.1       14.29        9.52           0
3          NA          NA          NA          NA          NA          NA
  NIVEL_7_LP9 NIVEL_8_LP9 NIVEL_0_MT9 NIVEL_1_MT9 NIVEL_2_MT9 NIVEL_3_MT9
1          NA          NA          NA          NA          NA          NA
2           0           0        9.52       14.29       19.05       23.81
3          NA          NA          NA          NA          NA          NA
  NIVEL_4_MT9 NIVEL_5_MT9 NIVEL_6_MT9 NIVEL_7_MT9 NIVEL_8_MT9 NIVEL_9_MT9
1          NA          NA          NA          NA          NA          NA
2       23.81        9.52           0           0           0           0
3          NA          NA          NA          NA          NA          NA
  NU_MATRICULADOS_CENSO_EMT NU_PRESENTES_EMT TAXA_PARTICIPACAO_EMT
1                        NA               NA                    NA
2                        NA               NA                    NA
3                        NA               NA                    NA
  NIVEL_0_LPEMT NIVEL_1_LPEMT NIVEL_2_LPEMT NIVEL_3_LPEMT NIVEL_4_LPEMT
1            NA            NA            NA            NA            NA
2            NA            NA            NA            NA            NA
3            NA            NA            NA            NA            NA
  NIVEL_5_LPEMT NIVEL_6_LPEMT NIVEL_7_LPEMT NIVEL_8_LPEMT NIVEL_0_MTEMT
1            NA            NA            NA            NA            NA
2            NA            NA            NA            NA            NA
3            NA            NA            NA            NA            NA
  NIVEL_1_MTEMT NIVEL_2_MTEMT NIVEL_3_MTEMT NIVEL_4_MTEMT NIVEL_5_MTEMT
1            NA            NA            NA            NA            NA
2            NA            NA            NA            NA            NA
3            NA            NA            NA            NA            NA
  NIVEL_6_MTEMT NIVEL_7_MTEMT NIVEL_8_MTEMT NIVEL_9_MTEMT NIVEL_10_MTEMT
1            NA            NA            NA            NA             NA
2            NA            NA            NA            NA             NA
3            NA            NA            NA            NA             NA
  NU_MATRICULADOS_CENSO_EMI NU_PRESENTES_EMI TAXA_PARTICIPACAO_EMI
1                        NA               NA                    NA
2                        NA               NA                    NA
3                        NA               NA                    NA
  NIVEL_0_LPEMI NIVEL_1_LPEMI NIVEL_2_LPEMI NIVEL_3_LPEMI NIVEL_4_LPEMI
1            NA            NA            NA            NA            NA
2            NA            NA            NA            NA            NA
3            NA            NA            NA            NA            NA
  NIVEL_5_LPEMI NIVEL_6_LPEMI NIVEL_7_LPEMI NIVEL_8_LPEMI NIVEL_0_MTEMI
1            NA            NA            NA            NA            NA
2            NA            NA            NA            NA            NA
3            NA            NA            NA            NA            NA
  NIVEL_1_MTEMI NIVEL_2_MTEMI NIVEL_3_MTEMI NIVEL_4_MTEMI NIVEL_5_MTEMI
1            NA            NA            NA            NA            NA
2            NA            NA            NA            NA            NA
3            NA            NA            NA            NA            NA
  NIVEL_6_MTEMI NIVEL_7_MTEMI NIVEL_8_MTEMI NIVEL_9_MTEMI NIVEL_10_MTEMI
1            NA            NA            NA            NA             NA
2            NA            NA            NA            NA             NA
3            NA            NA            NA            NA             NA
  NU_MATRICULADOS_CENSO_EM NU_PRESENTES_EM TAXA_PARTICIPACAO_EM NIVEL_0_LPEM
1                       NA              NA                   NA           NA
2                       NA              NA                   NA           NA
3                       NA              NA                   NA           NA
  NIVEL_1_LPEM NIVEL_2_LPEM NIVEL_3_LPEM NIVEL_4_LPEM NIVEL_5_LPEM NIVEL_6_LPEM
1           NA           NA           NA           NA           NA           NA
2           NA           NA           NA           NA           NA           NA
3           NA           NA           NA           NA           NA           NA
  NIVEL_7_LPEM NIVEL_8_LPEM NIVEL_0_MTEM NIVEL_1_MTEM NIVEL_2_MTEM NIVEL_3_MTEM
1           NA           NA           NA           NA           NA           NA
2           NA           NA           NA           NA           NA           NA
3           NA           NA           NA           NA           NA           NA
  NIVEL_4_MTEM NIVEL_5_MTEM NIVEL_6_MTEM NIVEL_7_MTEM NIVEL_8_MTEM NIVEL_9_MTEM
1           NA           NA           NA           NA           NA           NA
2           NA           NA           NA           NA           NA           NA
3           NA           NA           NA           NA           NA           NA
  NIVEL_10_MTEM MEDIA_5EF_LP MEDIA_5EF_MT MEDIA_9EF_LP MEDIA_9EF_MT
1            NA       157.99       168.75           NA           NA
2            NA           NA           NA       255.49       254.43
3            NA           NA           NA           NA           NA
  MEDIA_EMT_LP MEDIA_EMT_MT MEDIA_EMI_LP MEDIA_EMI_MT MEDIA_EM_LP MEDIA_EM_MT
1           NA           NA           NA           NA          NA          NA
2           NA           NA           NA           NA          NA          NA
3           NA           NA           NA           NA          NA          NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(saeb21)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   70897 obs. of  137 variables:
 $ ID_SAEB                    : int  2021 2021 2021 2021 2021 2021 2021 2021 2021 2021 ...
 $ ID_REGIAO                  : int  1 1 1 1 1 1 1 1 1 1 ...
 $ ID_UF                      : int  11 11 11 11 11 11 11 11 11 11 ...
 $ ID_MUNICIPIO               : int  6316600 6316600 6316600 6316600 6316600 6316600 6316600 6316600 6316600 6316600 ...
 $ ID_AREA                    : int  2 2 2 2 2 2 2 2 2 2 ...
 $ ID_ESCOLA                  : int  61324549 61335087 61336597 61342611 61363380 61371510 61385405 61393291 61395614 61395615 ...
 $ IN_PUBLICA                 : int  1 1 1 1 1 1 1 1 1 1 ...
 $ ID_LOCALIZACAO             : int  1 1 2 1 1 1 1 1 1 2 ...
 $ PC_FORMACAO_DOCENTE_INICIAL: num  100 92.5 100 100 87.5 NA 100 NA 100 100 ...
 $ PC_FORMACAO_DOCENTE_FINAL  : num  51.1 63.9 56.8 53.6 26.9 69.8 36.4 75 66.7 39.6 ...
 $ PC_FORMACAO_DOCENTE_MEDIO  : num  NA NA NA 82.2 NA 57.9 NA 70.2 NA NA ...
 $ NIVEL_SOCIO_ECONOMICO      : chr  "Nível IV" "Nível IV" "Nível IV" "Nível IV" ...
 $ NU_MATRICULADOS_CENSO_5EF  : int  18 23 19 26 13 NA 14 NA 20 21 ...
 $ NU_PRESENTES_5EF           : int  17 14 15 24 11 NA 11 NA 19 19 ...
 $ TAXA_PARTICIPACAO_5EF      : num  0.944 0.609 0.789 0.923 0.846 ...
 $ NIVEL_0_LP5                : num  25 NA NA 0 9.09 ...
 $ NIVEL_1_LP5                : num  18.8 NA NA 16.7 18.2 ...
 $ NIVEL_2_LP5                : num  25 NA NA 8.33 18.18 ...
 $ NIVEL_3_LP5                : num  12.5 NA NA 25 36.4 ...
 $ NIVEL_4_LP5                : num  12.5 NA NA 20.8 18.2 ...
 $ NIVEL_5_LP5                : num  6.25 NA NA 12.5 0 NA NA NA 0 0 ...
 $ NIVEL_6_LP5                : num  0 NA NA 4.17 0 NA NA NA 0 5.26 ...
 $ NIVEL_7_LP5                : num  0 NA NA 0 0 NA NA NA 0 0 ...
 $ NIVEL_8_LP5                : num  0 NA NA 12.5 0 NA NA NA 0 0 ...
 $ NIVEL_9_LP5                : num  0 NA NA 0 0 NA NA NA 0 0 ...
 $ NIVEL_0_MT5                : num  6.25 NA NA 4.17 18.18 ...
 $ NIVEL_1_MT5                : num  31.25 NA NA 4.17 18.18 ...
 $ NIVEL_2_MT5                : num  25 NA NA 12.5 9.09 ...
 $ NIVEL_3_MT5                : num  12.5 NA NA 16.7 27.3 ...
 $ NIVEL_4_MT5                : num  18.8 NA NA 25 18.2 ...
 $ NIVEL_5_MT5                : num  6.25 NA NA 12.5 9.09 NA NA NA 5.26 5.26 ...
 $ NIVEL_6_MT5                : num  0 NA NA 8.33 0 NA NA NA 0 0 ...
 $ NIVEL_7_MT5                : num  0 NA NA 16.7 0 ...
 $ NIVEL_8_MT5                : num  0 NA NA 0 0 NA NA NA 0 0 ...
 $ NIVEL_9_MT5                : num  0 NA NA 0 0 NA NA NA 0 0 ...
 $ NIVEL_10_MT5               : num  0 NA NA 0 0 NA NA NA 0 0 ...
 $ NU_MATRICULADOS_CENSO_9EF  : int  19 24 18 NA 11 166 NA 93 NA 13 ...
 $ NU_PRESENTES_9EF           : int  15 21 13 NA 6 141 NA 85 NA 11 ...
 $ TAXA_PARTICIPACAO_9EF      : num  0.789 0.875 0.722 NA 0.545 ...
 $ NIVEL_0_LP9                : num  NA 9.52 NA NA NA ...
 $ NIVEL_1_LP9                : num  NA 9.52 NA NA NA ...
 $ NIVEL_2_LP9                : num  NA 19.1 NA NA NA ...
 $ NIVEL_3_LP9                : num  NA 38.1 NA NA NA ...
 $ NIVEL_4_LP9                : num  NA 14.3 NA NA NA ...
 $ NIVEL_5_LP9                : num  NA 9.52 NA NA NA ...
 $ NIVEL_6_LP9                : num  NA 0 NA NA NA 2.87 NA 4.97 NA 0 ...
 $ NIVEL_7_LP9                : num  NA 0 NA NA NA 0.65 NA 6.27 NA 0 ...
 $ NIVEL_8_LP9                : num  NA 0 NA NA NA 0 NA 0 NA 0 ...
 $ NIVEL_0_MT9                : num  NA 9.52 NA NA NA ...
 $ NIVEL_1_MT9                : num  NA 14.3 NA NA NA ...
 $ NIVEL_2_MT9                : num  NA 19.1 NA NA NA ...
 $ NIVEL_3_MT9                : num  NA 23.8 NA NA NA ...
 $ NIVEL_4_MT9                : num  NA 23.8 NA NA NA ...
 $ NIVEL_5_MT9                : num  NA 9.52 NA NA NA ...
 $ NIVEL_6_MT9                : num  NA 0 NA NA NA 1.48 NA 1.3 NA 0 ...
 $ NIVEL_7_MT9                : num  NA 0 NA NA NA 0 NA 1.3 NA 0 ...
 $ NIVEL_8_MT9                : num  NA 0 NA NA NA 0 NA 0 NA 0 ...
 $ NIVEL_9_MT9                : int  NA 0 NA NA NA 0 NA 0 NA 0 ...
 $ NU_MATRICULADOS_CENSO_EMT  : int  NA NA NA 90 NA 90 NA 53 NA NA ...
 $ NU_PRESENTES_EMT           : int  NA NA NA 76 NA 61 NA 50 NA NA ...
 $ TAXA_PARTICIPACAO_EMT      : num  NA NA NA 0.844 NA ...
 $ NIVEL_0_LPEMT              : num  NA NA NA 35.1 NA ...
 $ NIVEL_1_LPEMT              : num  NA NA NA 15.9 NA ...
 $ NIVEL_2_LPEMT              : num  NA NA NA 16.4 NA ...
 $ NIVEL_3_LPEMT              : num  NA NA NA 16.4 NA ...
 $ NIVEL_4_LPEMT              : num  NA NA NA 8.92 NA ...
 $ NIVEL_5_LPEMT              : num  NA NA NA 4.29 NA ...
 $ NIVEL_6_LPEMT              : num  NA NA NA 2.94 NA ...
 $ NIVEL_7_LPEMT              : num  NA NA NA 0 NA NA NA 4.02 NA NA ...
 $ NIVEL_8_LPEMT              : num  NA NA NA 0 NA NA NA 0 NA NA ...
 $ NIVEL_0_MTEMT              : num  NA NA NA 31.7 NA ...
 $ NIVEL_1_MTEMT              : num  NA NA NA 21.8 NA ...
 $ NIVEL_2_MTEMT              : num  NA NA NA 14.8 NA ...
 $ NIVEL_3_MTEMT              : num  NA NA NA 14.8 NA ...
 $ NIVEL_4_MTEMT              : num  NA NA NA 8.81 NA ...
 $ NIVEL_5_MTEMT              : num  NA NA NA 6.48 NA ...
 $ NIVEL_6_MTEMT              : num  NA NA NA 1.56 NA NA NA 9.93 NA NA ...
 $ NIVEL_7_MTEMT              : num  NA NA NA 0 NA NA NA 0 NA NA ...
 $ NIVEL_8_MTEMT              : num  NA NA NA 0 NA NA NA 0 NA NA ...
 $ NIVEL_9_MTEMT              : num  NA NA NA 0 NA NA NA 2.13 NA NA ...
 $ NIVEL_10_MTEMT             : int  NA NA NA 0 NA NA NA 0 NA NA ...
 $ NU_MATRICULADOS_CENSO_EMI  : int  NA NA NA NA NA NA NA NA NA NA ...
 $ NU_PRESENTES_EMI           : int  NA NA NA NA NA NA NA NA NA NA ...
 $ TAXA_PARTICIPACAO_EMI      : num  NA NA NA NA NA NA NA NA NA NA ...
 $ NIVEL_0_LPEMI              : num  NA NA NA NA NA NA NA NA NA NA ...
 $ NIVEL_1_LPEMI              : num  NA NA NA NA NA NA NA NA NA NA ...
 $ NIVEL_2_LPEMI              : num  NA NA NA NA NA NA NA NA NA NA ...
 $ NIVEL_3_LPEMI              : num  NA NA NA NA NA NA NA NA NA NA ...
 $ NIVEL_4_LPEMI              : num  NA NA NA NA NA NA NA NA NA NA ...
 $ NIVEL_5_LPEMI              : num  NA NA NA NA NA NA NA NA NA NA ...
 $ NIVEL_6_LPEMI              : num  NA NA NA NA NA NA NA NA NA NA ...
 $ NIVEL_7_LPEMI              : num  NA NA NA NA NA NA NA NA NA NA ...
 $ NIVEL_8_LPEMI              : num  NA NA NA NA NA NA NA NA NA NA ...
 $ NIVEL_0_MTEMI              : num  NA NA NA NA NA NA NA NA NA NA ...
 $ NIVEL_1_MTEMI              : num  NA NA NA NA NA NA NA NA NA NA ...
 $ NIVEL_2_MTEMI              : num  NA NA NA NA NA NA NA NA NA NA ...
 $ NIVEL_3_MTEMI              : num  NA NA NA NA NA NA NA NA NA NA ...
 $ NIVEL_4_MTEMI              : num  NA NA NA NA NA NA NA NA NA NA ...
 $ NIVEL_5_MTEMI              : num  NA NA NA NA NA NA NA NA NA NA ...
  [list output truncated]</code></pre>
</div>
</div>
<p>Embora não seja recomendado olhar para a planilha de dados quando o volume é muito grande, podemos utilizar recursos para observar apenas uma parte dos dados.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>( <span class="fu">head</span>(saeb21) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Após observar a estrutura dos dados, temos uma ideia de quais variáveis e casos a base de dados guarda.</p>
<p>Agora, podemos partir para o manuseio dos dados.</p>
<section id="select-e-filter" class="level2">
<h2 class="anchored" data-anchor-id="select-e-filter">Select e Filter</h2>
<p>Como vimos anteriormente, podemos filtrar e selecionar nossa base usando apenas comandos básicos do R.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Selecionar variáveis</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>minha_selecao_dados <span class="ot">&lt;-</span> saeb21[,<span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">12</span>)]</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(minha_selecao_dados)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  ID_ESCOLA NIVEL_SOCIO_ECONOMICO
1  61324549              Nível IV
2  61335087              Nível IV
3  61336597              Nível IV
4  61342611              Nível IV
5  61363380              Nível IV
6  61371510              Nível IV</code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtrar casos </span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>meu_filtro_casos <span class="ot">&lt;-</span> saeb21[ , <span class="dv">12</span> ] <span class="sc">==</span> <span class="st">"Nível I"</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>meu_filtro_casos <span class="ot">&lt;-</span> saeb21[ meu_filtro_casos, <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">12</span>) ]</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(meu_filtro_casos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     ID_ESCOLA NIVEL_SOCIO_ECONOMICO
1205  61380274               Nível I
1273  61357328               Nível I
1395  61331399               Nível I
1409  61361024               Nível I
1609  61328397               Nível I
1632  61371579               Nível I</code></pre>
</div>
</div>
<p>Para tornar nosso código mais interpretável e organizado, vamos utilizar as funções do pacote tidyverse para operações de manuseio dos dados. Veja como tudo fica mais simples.</p>
<ul>
<li><p>select( ) : função para selecionar colunas/variáveis</p></li>
<li><p>filter( ): função para filtrar casos</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Selecionar variáveis</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>minha_selecao_dados <span class="ot">&lt;-</span> <span class="fu">select</span>(</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">.data =</span> saeb21,</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  ID_ESCOLA,NIVEL_SOCIO_ECONOMICO)</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(minha_selecao_dados)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  ID_ESCOLA NIVEL_SOCIO_ECONOMICO
1  61324549              Nível IV
2  61335087              Nível IV
3  61336597              Nível IV
4  61342611              Nível IV
5  61363380              Nível IV
6  61371510              Nível IV</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>meu_filtro_casos <span class="ot">&lt;-</span> <span class="fu">filter</span>(</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">.data =</span> saeb21,</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  NIVEL_SOCIO_ECONOMICO <span class="sc">==</span> <span class="st">"Nível I"</span>)</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(meu_filtro_casos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  ID_SAEB ID_REGIAO ID_UF ID_MUNICIPIO ID_AREA ID_ESCOLA IN_PUBLICA
1    2021         1    13      6316682       2  61380274          1
2    2021         1    13      6316686       2  61357328          1
3    2021         1    13      6316693       2  61331399          1
4    2021         1    13      6316693       2  61361024          1
5    2021         1    13      6316703       2  61328397          1
6    2021         1    13      6316705       2  61371579          1
  ID_LOCALIZACAO PC_FORMACAO_DOCENTE_INICIAL PC_FORMACAO_DOCENTE_FINAL
1              2                        32.1                      22.2
2              2                       100.0                      12.5
3              2                        70.8                      16.4
4              2                        37.5                       9.1
5              2                         0.0                       0.0
6              2                         0.0                       0.0
  PC_FORMACAO_DOCENTE_MEDIO NIVEL_SOCIO_ECONOMICO NU_MATRICULADOS_CENSO_5EF
1                        NA               Nível I                        16
2                        NA               Nível I                        11
3                        NA               Nível I                        11
4                        NA               Nível I                        11
5                        NA               Nível I                        28
6                        NA               Nível I                        19
  NU_PRESENTES_5EF TAXA_PARTICIPACAO_5EF NIVEL_0_LP5 NIVEL_1_LP5 NIVEL_2_LP5
1               14             0.8750000        7.14       50.00       28.57
2               10             0.9090909       40.00       20.00       30.00
3               11             1.0000000       18.18       54.55        9.09
4               11             1.0000000        9.09       45.45       18.18
5                8             0.2857143          NA          NA          NA
6               11             0.5789474          NA          NA          NA
  NIVEL_3_LP5 NIVEL_4_LP5 NIVEL_5_LP5 NIVEL_6_LP5 NIVEL_7_LP5 NIVEL_8_LP5
1       14.29        0.00        0.00           0           0           0
2       10.00        0.00        0.00           0           0           0
3        9.09        0.00        9.09           0           0           0
4        9.09        9.09        9.09           0           0           0
5          NA          NA          NA          NA          NA          NA
6          NA          NA          NA          NA          NA          NA
  NIVEL_9_LP5 NIVEL_0_MT5 NIVEL_1_MT5 NIVEL_2_MT5 NIVEL_3_MT5 NIVEL_4_MT5
1           0        0.00       42.86       35.71       14.29        7.14
2           0       10.00       20.00       50.00       20.00        0.00
3           0        9.09       18.18       27.27       18.18       27.27
4           0        9.09        9.09       18.18       36.36        9.09
5          NA          NA          NA          NA          NA          NA
6          NA          NA          NA          NA          NA          NA
  NIVEL_5_MT5 NIVEL_6_MT5 NIVEL_7_MT5 NIVEL_8_MT5 NIVEL_9_MT5 NIVEL_10_MT5
1        0.00        0.00           0           0           0            0
2        0.00        0.00           0           0           0            0
3        0.00        0.00           0           0           0            0
4        9.09        9.09           0           0           0            0
5          NA          NA          NA          NA          NA           NA
6          NA          NA          NA          NA          NA           NA
  NU_MATRICULADOS_CENSO_9EF NU_PRESENTES_9EF TAXA_PARTICIPACAO_9EF NIVEL_0_LP9
1                        NA               NA                    NA          NA
2                        NA               NA                    NA          NA
3                        18               17             0.9444444       41.18
4                        13               13             1.0000000       30.77
5                        NA               NA                    NA          NA
6                        26               18             0.6923077          NA
  NIVEL_1_LP9 NIVEL_2_LP9 NIVEL_3_LP9 NIVEL_4_LP9 NIVEL_5_LP9 NIVEL_6_LP9
1          NA          NA          NA          NA          NA          NA
2          NA          NA          NA          NA          NA          NA
3       41.18       17.65        0.00           0           0           0
4       38.46       15.38       15.38           0           0           0
5          NA          NA          NA          NA          NA          NA
6          NA          NA          NA          NA          NA          NA
  NIVEL_7_LP9 NIVEL_8_LP9 NIVEL_0_MT9 NIVEL_1_MT9 NIVEL_2_MT9 NIVEL_3_MT9
1          NA          NA          NA          NA          NA          NA
2          NA          NA          NA          NA          NA          NA
3           0           0       52.94       35.29        5.88        5.88
4           0           0       30.77        7.69       38.46       23.08
5          NA          NA          NA          NA          NA          NA
6          NA          NA          NA          NA          NA          NA
  NIVEL_4_MT9 NIVEL_5_MT9 NIVEL_6_MT9 NIVEL_7_MT9 NIVEL_8_MT9 NIVEL_9_MT9
1          NA          NA          NA          NA          NA          NA
2          NA          NA          NA          NA          NA          NA
3           0           0           0           0           0           0
4           0           0           0           0           0           0
5          NA          NA          NA          NA          NA          NA
6          NA          NA          NA          NA          NA          NA
  NU_MATRICULADOS_CENSO_EMT NU_PRESENTES_EMT TAXA_PARTICIPACAO_EMT
1                        NA               NA                    NA
2                        NA               NA                    NA
3                        NA               NA                    NA
4                        NA               NA                    NA
5                        NA               NA                    NA
6                        NA               NA                    NA
  NIVEL_0_LPEMT NIVEL_1_LPEMT NIVEL_2_LPEMT NIVEL_3_LPEMT NIVEL_4_LPEMT
1            NA            NA            NA            NA            NA
2            NA            NA            NA            NA            NA
3            NA            NA            NA            NA            NA
4            NA            NA            NA            NA            NA
5            NA            NA            NA            NA            NA
6            NA            NA            NA            NA            NA
  NIVEL_5_LPEMT NIVEL_6_LPEMT NIVEL_7_LPEMT NIVEL_8_LPEMT NIVEL_0_MTEMT
1            NA            NA            NA            NA            NA
2            NA            NA            NA            NA            NA
3            NA            NA            NA            NA            NA
4            NA            NA            NA            NA            NA
5            NA            NA            NA            NA            NA
6            NA            NA            NA            NA            NA
  NIVEL_1_MTEMT NIVEL_2_MTEMT NIVEL_3_MTEMT NIVEL_4_MTEMT NIVEL_5_MTEMT
1            NA            NA            NA            NA            NA
2            NA            NA            NA            NA            NA
3            NA            NA            NA            NA            NA
4            NA            NA            NA            NA            NA
5            NA            NA            NA            NA            NA
6            NA            NA            NA            NA            NA
  NIVEL_6_MTEMT NIVEL_7_MTEMT NIVEL_8_MTEMT NIVEL_9_MTEMT NIVEL_10_MTEMT
1            NA            NA            NA            NA             NA
2            NA            NA            NA            NA             NA
3            NA            NA            NA            NA             NA
4            NA            NA            NA            NA             NA
5            NA            NA            NA            NA             NA
6            NA            NA            NA            NA             NA
  NU_MATRICULADOS_CENSO_EMI NU_PRESENTES_EMI TAXA_PARTICIPACAO_EMI
1                        NA               NA                    NA
2                        NA               NA                    NA
3                        NA               NA                    NA
4                        NA               NA                    NA
5                        NA               NA                    NA
6                        NA               NA                    NA
  NIVEL_0_LPEMI NIVEL_1_LPEMI NIVEL_2_LPEMI NIVEL_3_LPEMI NIVEL_4_LPEMI
1            NA            NA            NA            NA            NA
2            NA            NA            NA            NA            NA
3            NA            NA            NA            NA            NA
4            NA            NA            NA            NA            NA
5            NA            NA            NA            NA            NA
6            NA            NA            NA            NA            NA
  NIVEL_5_LPEMI NIVEL_6_LPEMI NIVEL_7_LPEMI NIVEL_8_LPEMI NIVEL_0_MTEMI
1            NA            NA            NA            NA            NA
2            NA            NA            NA            NA            NA
3            NA            NA            NA            NA            NA
4            NA            NA            NA            NA            NA
5            NA            NA            NA            NA            NA
6            NA            NA            NA            NA            NA
  NIVEL_1_MTEMI NIVEL_2_MTEMI NIVEL_3_MTEMI NIVEL_4_MTEMI NIVEL_5_MTEMI
1            NA            NA            NA            NA            NA
2            NA            NA            NA            NA            NA
3            NA            NA            NA            NA            NA
4            NA            NA            NA            NA            NA
5            NA            NA            NA            NA            NA
6            NA            NA            NA            NA            NA
  NIVEL_6_MTEMI NIVEL_7_MTEMI NIVEL_8_MTEMI NIVEL_9_MTEMI NIVEL_10_MTEMI
1            NA            NA            NA            NA             NA
2            NA            NA            NA            NA             NA
3            NA            NA            NA            NA             NA
4            NA            NA            NA            NA             NA
5            NA            NA            NA            NA             NA
6            NA            NA            NA            NA             NA
  NU_MATRICULADOS_CENSO_EM NU_PRESENTES_EM TAXA_PARTICIPACAO_EM NIVEL_0_LPEM
1                       NA              NA                   NA           NA
2                       NA              NA                   NA           NA
3                       NA              NA                   NA           NA
4                       NA              NA                   NA           NA
5                       NA              NA                   NA           NA
6                       NA              NA                   NA           NA
  NIVEL_1_LPEM NIVEL_2_LPEM NIVEL_3_LPEM NIVEL_4_LPEM NIVEL_5_LPEM NIVEL_6_LPEM
1           NA           NA           NA           NA           NA           NA
2           NA           NA           NA           NA           NA           NA
3           NA           NA           NA           NA           NA           NA
4           NA           NA           NA           NA           NA           NA
5           NA           NA           NA           NA           NA           NA
6           NA           NA           NA           NA           NA           NA
  NIVEL_7_LPEM NIVEL_8_LPEM NIVEL_0_MTEM NIVEL_1_MTEM NIVEL_2_MTEM NIVEL_3_MTEM
1           NA           NA           NA           NA           NA           NA
2           NA           NA           NA           NA           NA           NA
3           NA           NA           NA           NA           NA           NA
4           NA           NA           NA           NA           NA           NA
5           NA           NA           NA           NA           NA           NA
6           NA           NA           NA           NA           NA           NA
  NIVEL_4_MTEM NIVEL_5_MTEM NIVEL_6_MTEM NIVEL_7_MTEM NIVEL_8_MTEM NIVEL_9_MTEM
1           NA           NA           NA           NA           NA           NA
2           NA           NA           NA           NA           NA           NA
3           NA           NA           NA           NA           NA           NA
4           NA           NA           NA           NA           NA           NA
5           NA           NA           NA           NA           NA           NA
6           NA           NA           NA           NA           NA           NA
  NIVEL_10_MTEM MEDIA_5EF_LP MEDIA_5EF_MT MEDIA_9EF_LP MEDIA_9EF_MT
1            NA       148.26       162.14           NA           NA
2            NA       138.99       157.12           NA           NA
3            NA       150.27       172.89       197.58       195.03
4            NA       160.68       182.92       208.62       226.94
5            NA           NA           NA           NA           NA
6            NA           NA           NA           NA           NA
  MEDIA_EMT_LP MEDIA_EMT_MT MEDIA_EMI_LP MEDIA_EMI_MT MEDIA_EM_LP MEDIA_EM_MT
1           NA           NA           NA           NA          NA          NA
2           NA           NA           NA           NA          NA          NA
3           NA           NA           NA           NA          NA          NA
4           NA           NA           NA           NA          NA          NA
5           NA           NA           NA           NA          NA          NA
6           NA           NA           NA           NA          NA          NA</code></pre>
</div>
</div>
<p>Agora, para continuar trabalhando com esses dados, vamos fazer uma seleção de variáveis e um filtro de casos conforme nossos interesses.</p>
<p>Para isso, vamos introduzir o uso do <em>pipe</em>, uma estrutura de código muito útil na programação. O <em>pipe</em> é composto pelo símbolo %&gt;%, e representa a ideia de que um objeto é tomado como referêcia para a próxima função a ser utilizada.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>meu_saeb21 <span class="ot">&lt;-</span> saeb21 <span class="sc">%&gt;%</span> <span class="fu">select</span>(ID_ESCOLA,IN_PUBLICA,</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>                                TAXA_PARTICIPACAO_9EF,</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>                                MEDIA_9EF_MT,MEDIA_9EF_LP,</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>                                NIVEL_SOCIO_ECONOMICO)</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtro para escolas que tiveram mais de 80% (0.8) dos estudantes matriculados participando da prova</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>meu_saeb21 <span class="ot">&lt;-</span> meu_saeb21 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(TAXA_PARTICIPACAO_9EF <span class="sc">&gt;=</span> <span class="fl">0.8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="rename" class="level2">
<h2 class="anchored" data-anchor-id="rename">Rename</h2>
<p>Depois de filtrada e selecionada a nossa base de dados, podemos renomear nossas variáveis para deixá-la mais intuitiva. Muitas vezes elas estão codificadas e dificultam a interpretação e manuseio. Para isso, utilizaremos a função rename.</p>
<ul>
<li>rename( ): para renomear colunas/variáveis</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>meu_saeb21 <span class="ot">&lt;-</span> meu_saeb21 <span class="sc">%&gt;%</span> <span class="fu">rename</span>(</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">pub =</span> IN_PUBLICA,</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">tx_participacao =</span> TAXA_PARTICIPACAO_9EF,</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">mt =</span> MEDIA_9EF_MT,</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">lp =</span> MEDIA_9EF_LP,</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">nse =</span> NIVEL_SOCIO_ECONOMICO</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(meu_saeb21)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  ID_ESCOLA pub tx_participacao     mt     lp       nse
1  61335087   1       0.8750000 254.43 255.49  Nível IV
2  61371510   1       0.8493976 247.14 244.83  Nível IV
3  61393291   1       0.9139785 258.05 272.48   Nível V
4  61395615   1       0.8461538 224.97 237.50 Nível III
5  61328737   1       0.8587571 258.11 255.03   Nível V
6  61332918   1       0.8421053 267.24 271.96   Nível V</code></pre>
</div>
</div>
</section>
<section id="export" class="level2">
<h2 class="anchored" data-anchor-id="export">Export</h2>
<p>Tendo selecionado e filtrado os dados, podemos salvar o recorte da base original em um novo arquivo, para continuar o manuseio no próximo capítulo. Para isso, usamos a função <em>export</em> do pacote Rio.</p>
<ul>
<li>export( ) : para exportar dados do R</li>
</ul>
<p>Assim como a função <em>import</em>, basta inserir o endereço do diretório e, no final, o nome do arquivo com a extensão desejada para salvar. O pacote rio comporta as extensões mais utilizadas (excel - xlsx, spss - sav, comma separated values - csv, etc.).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">export</span>(<span class="at">x =</span> meu_saeb21,</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">file =</span> <span class="st">"D:/01 - data/EDUC/SAEB/2021/DADOS/meu_saeb21.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="recaptulando" class="level1">
<h1>Recaptulando</h1>
</section>
<section id="extra-unir-bases-de-dados-com-chave-de-identificação-comum" class="level1">
<h1>Extra: unir bases de dados com chave de identificação comum</h1>
</section>
<section id="desafio" class="level1">
<h1>Desafio</h1>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>